<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Spice Chat - Group Chat, Fun & Games</title>
  <link rel="stylesheet" href="style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@700;900&family=Roboto:wght@400;500&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/all.min.css">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.13/cropper.min.js"></script>
</head>
<body>
  <!-- Header -->
  <header class="header">
    <div class="logo fade-in-left">
      <img src="assets/logo.png" alt="Spice Logo" height="40">
      <span>Spice</span>
    </div>
    <nav class="main-nav fade-in-up">
      <a href="#" class="nav-link">Home</a>
      <a href="#" class="nav-link">Devs</a>
      <a href="#" class="nav-link">More</a>
    </nav>
    <button class="btn btn-login fade-in-right" id="open-login">Log In</button>
  </header>

  <!-- Hero Section -->
  <section class="hero">
    <div class="hero-content">
      <h1 class="hero-title fade-in-up headline-shine">GROUP CHAT THAT'S ALL FUN & GAMES</h1>
      <p class="hero-desc fade-in-up">Spice is your place to talk, play, and hang out. Create your own space, connect with friends, and enjoy seamless group chat with a stunning, modern design.</p>
      <div class="hero-actions animate-stagger">
        <button class="btn btn-primary">Get Started</button>
        <button class="btn btn-secondary" id="open-signup">Sign Up</button>
      </div>
    </div>
    <div class="hero-visuals fade-in-right">
      <!-- Placeholder for hero image/illustration -->
      <img src="assets/hero.png" alt="Chat Illustration" class="hero-img">
    </div>
  </section>

  <!-- Info Section -->
  <section class="info fade-in-up">
    <h2>Why Choose Spice?</h2>
    <div class="info-features animate-stagger">
      <div class="feature">
        <h3>Lightning Fast</h3>
        <p>Experience real-time chat with zero lag, powered by modern tech.</p>
      </div>
      <div class="feature">
        <h3>Stunning Design</h3>
        <p>Enjoy a beautiful, pro-level interface inspired by the best in the industry.</p>
      </div>
      <div class="feature">
        <h3>Simple & Secure</h3>
        <p>Easy to use, with privacy and security at the core.</p>
      </div>
    </div>
  </section>

  <!-- Login/Signup Modal -->
  <div class="modal-overlay" id="modal-overlay">
    <div class="modal" id="auth-modal">
      <button class="modal-close" id="close-modal">&times;</button>
      <div class="modal-content" id="modal-content">
        <!-- Login/Signup forms will be injected here by JS -->
      </div>
    </div>
  </div>

  <!-- Main App Layout (hidden by default, shown after login/signup) -->
  <div class="main-app-layout" id="main-app-layout" style="display:none;">
    <aside class="sidebar servers-sidebar">
      <div class="servers-list">
        <button class="server-btn add-server-btn" title="Add Server"><i class="fa-solid fa-plus"></i></button>
        <button class="server-btn"></button>
        <button class="server-btn"></button>
        <button class="server-btn"></button>
      </div>
    </aside>
    <aside class="sidebar channels-sidebar">
      <div class="channels-list">
        <!-- Channel list goes here -->
      </div>
      <button id="create-channel-btn" class="create-channel-btn" type="button"><i class="fa-solid fa-plus"></i> Create Channel</button>
      <button id="sidebar-user-profile" class="sidebar-user-profile sidebar-user-profile-btn" type="button"></button>
    </aside>
    <main class="chat-section">
      <header class="chat-header">
        <!-- Channel name, topic, etc. -->
      </header>
      <section class="chat-messages">
        <!-- Messages will appear here -->
      </section>
      <footer class="chat-input-area">
        <!-- Message input and voice controls -->
      </footer>
    </main>
    <aside class="sidebar users-sidebar">
      <button class="add-friend-btn" id="open-add-friend-modal">+ Add Friends</button>
      <!-- User list/profile -->
    </aside>
  </div>

  <!-- Profile/Settings Modal (hidden by default) -->
  <div id="profile-modal" class="profile-modal-overlay" style="display:none;">
    <div class="profile-modal-container">
      <aside class="profile-modal-sidebar modal-slide-in-left">
        <nav class="profile-settings-nav">
          <button class="nav-link active">My Account</button>
          <button class="nav-link">Join Servers</button>
        </nav>
      </aside>
      <section class="profile-modal-content">
        <header class="profile-modal-header modal-fade-in">
          <h2 id="profile-modal-title">My Account</h2>
          <button class="profile-modal-close" id="close-profile-modal" title="Close">&times;</button>
        </header>
        <div class="modal-stagger">
          <div id="profile-section-my-account">
            <nav class="profile-tabs">
              <button class="tab-link active">Main Profile</button>
            </nav>
            <div class="profile-banner-promo">
              <div class="banner-img"></div>
              <div class="banner-text">
                <div class="banner-title">Give your profile a fresh look</div>
                <div class="banner-desc">Check out the latest avatar decorations, profile effects, and nameplates and collect your favorite styles.</div>
              </div>
              <button class="banner-cta">Go to Shop</button>
            </div>
            <form class="profile-form">
              <label>Display Name
                <input type="text" class="profile-input" placeholder="Display Name">
              </label>
              <label>Pronouns
                <input type="text" class="profile-input" placeholder="Add your pronouns">
              </label>
              <div class="profile-avatar-controls">
                <span>Avatar</span>
                <button class="profile-btn">Change Avatar</button>
                <button class="profile-btn secondary">Remove Avatar</button>
              </div>
            </form>
            <div class="profile-preview-section">
              <div class="profile-preview-card">
                <div class="profile-banner">
                  <button class="profile-change-banner-btn" title="Change Banner"><i class="fa-solid fa-camera"></i></button>
                </div>
                <div class="profile-avatar-stack">
                  <img class="profile-avatar-img" src="https://randomuser.me/api/portraits/men/32.jpg" alt="Avatar">
                  <span class="profile-status-badge"><i class="fa-solid fa-minus"></i></span>
                  <button class="profile-add-status" disabled><i class="fa-solid fa-plus"></i> Add Status</button>
                </div>
                <div class="profile-info">
                  <div class="profile-displayname">NAVANEETH REDDY</div>
                  <div class="profile-username">rffastral <span class="profile-tag">#</span></div>
                </div>
                <div class="profile-action">
                  <button class="profile-action-btn">Example Button</button>
                </div>
              </div>
            </div>
            <div class="profile-nameplate-preview">
              <div class="nameplate-avatar"></div>
              <div class="nameplate-name"></div>
              <button class="nameplate-btn">Try it out</button>
            </div>
          </div>
          <div id="profile-section-join-servers" style="display:none;">
            <form id="join-server-form" class="profile-form">
              <label for="join-server-code">Enter Server Invite Code</label>
              <input type="text" id="join-server-code" class="profile-input" placeholder="Invite Code (e.g. ABC123)" required />
              <button type="submit" class="profile-btn">Join Server</button>
            </form>
            <div id="join-server-feedback" class="add-friend-feedback"></div>
            <div id="join-server-status" class="add-friend-feedback"></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <!-- Avatar Upload Input (hidden) -->
  <input type="file" id="avatar-upload-input" accept="image/*" style="display:none;" />

  <!-- Avatar Crop Modal (hidden by default) -->
  <div id="avatar-crop-modal" class="avatar-crop-modal" style="display:none;">
    <div class="avatar-crop-modal-content">
      <div id="avatar-crop-area"></div>
      <div class="avatar-crop-actions">
        <button id="avatar-crop-confirm" class="profile-btn">Crop & Upload</button>
        <button id="avatar-crop-cancel" class="profile-btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Avatar Upload Loading Spinner (hidden by default) -->
  <div id="avatar-upload-loading" class="avatar-upload-loading" style="display:none;">
    <div class="spinner"></div>
    <span>Uploading...</span>
  </div>

  <!-- Banner Upload Input (hidden) -->
  <input type="file" id="banner-upload-input" accept="image/*" style="display:none;" />

  <!-- Banner Crop Modal (hidden by default) -->
  <div id="banner-crop-modal" class="avatar-crop-modal" style="display:none;">
    <div class="avatar-crop-modal-content">
      <div id="banner-crop-area" style="border-radius:0.8rem;width:360px;height:90px;"></div>
      <div class="avatar-crop-actions">
        <button id="banner-crop-confirm" class="profile-btn">Crop & Upload</button>
        <button id="banner-crop-cancel" class="profile-btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Banner Upload Loading Spinner (hidden by default) -->
  <div id="banner-upload-loading" class="avatar-upload-loading" style="display:none;">
    <div class="spinner"></div>
    <span>Uploading...</span>
  </div>

  <!-- Add Friend Modal (hidden by default) -->
  <div id="add-friend-modal" class="add-friend-modal-overlay" style="display:none;">
    <div class="add-friend-modal-container modal-scale-in">
      <header class="add-friend-modal-header modal-fade-in">
        <h2>Add a Friend</h2>
        <button class="add-friend-modal-close" id="close-add-friend-modal" title="Close">&times;</button>
      </header>
      <form class="add-friend-form modal-stagger">
        <label for="add-friend-userid">Enter User ID</label>
        <input type="text" id="add-friend-userid" class="profile-input" placeholder="User ID (e.g. 123456789)" required />
        <button type="submit" class="profile-btn">Send Request</button>
      </form>
      <div id="add-friend-feedback" class="add-friend-feedback"></div>
      <div class="friend-requests-section modal-stagger">
        <h3>Received Requests</h3>
        <div id="received-requests-list" class="friend-requests-list"></div>
        <h3>Sent Requests</h3>
        <div id="sent-requests-list" class="friend-requests-list"></div>
      </div>
    </div>
  </div>

  <!-- Create Server Modal (hidden by default) -->
  <div class="modal-overlay" id="create-server-modal-overlay" style="display:none;">
    <div class="modal" id="create-server-modal">
      <button class="modal-close" id="close-create-server-modal">&times;</button>
      <div class="modal-content" id="create-server-modal-content">
        <h2 class="modal-title">Create a Server</h2>
        <form id="create-server-form" autocomplete="off">
          <div class="server-avatar-upload-section">
            <div class="server-avatar-preview-wrapper">
              <img id="create-server-avatar-preview" class="profile-avatar-img" src="assets/server-default.png" alt="Server Avatar" style="width:72px;height:72px;border-radius:50%;border:3px solid var(--primary-blue);background:var(--off-black);object-fit:cover;" />
              <button type="button" id="create-server-avatar-upload-btn" class="profile-btn secondary" style="margin-top:0.7rem;">Upload Avatar</button>
            </div>
            <input type="file" id="create-server-avatar-input" accept="image/*" style="display:none;" />
            <input type="hidden" id="create-server-avatar-url" name="server-avatar-url" />
          </div>
          <label for="server-name">Server Name</label>
          <input type="text" id="server-name" name="server-name" required maxlength="32" placeholder="Enter server name" />
          <button type="submit" class="profile-btn" style="margin-top:1.2rem;">Create Server</button>
        </form>
        <div id="create-server-success" style="display:none;"></div>
      </div>
    </div>
  </div>

  <!-- Create Channel Modal (hidden by default) -->
  <div class="modal-overlay" id="create-channel-modal-overlay" style="display:none;">
    <div class="modal" id="create-channel-modal">
      <button class="modal-close" id="close-create-channel-modal">&times;</button>
      <div class="modal-content create-channel-modal-content">
        <h2 class="modal-title">Create Channel</h2>
        <form id="create-channel-form">
          <div class="channel-type-section">
            <label class="channel-type-option selected" id="channel-type-text">
              <input type="radio" name="channel-type" value="text" checked hidden />
              <span class="channel-type-icon">#</span>
              <span class="channel-type-labels">
                <span class="channel-type-title">Text</span>
                <span class="channel-type-desc">Send messages, images, GIFs, emoji, opinions, and puns</span>
              </span>
            </label>
            <label class="channel-type-option" id="channel-type-voice">
              <input type="radio" name="channel-type" value="voice" hidden />
              <span class="channel-type-icon"><i class="fa-solid fa-volume-high"></i></span>
              <span class="channel-type-labels">
                <span class="channel-type-title">Voice</span>
                <span class="channel-type-desc">Hang out together with voice, video, and screen share</span>
              </span>
            </label>
          </div>
          <label for="new-channel-name" class="channel-name-label">Channel Name</label>
          <div class="channel-name-input-group">
            <span class="channel-name-prefix" id="channel-name-prefix">#</span>
            <input type="text" id="new-channel-name" name="new-channel-name" required maxlength="32" placeholder="new-channel" autocomplete="off" />
          </div>
          <div class="private-channel-section">
            <span class="private-channel-label"><i class="fa-solid fa-lock"></i> Private Channel</span>
            <label class="switch">
              <input type="checkbox" id="private-channel-toggle" disabled />
              <span class="slider round"></span>
            </label>
          </div>
          <div class="private-channel-desc">Only selected members and roles will be able to view this channel.</div>
          <div class="modal-actions">
            <button type="button" class="modal-cancel-btn" id="cancel-create-channel">Cancel</button>
            <button type="submit" class="modal-create-btn" id="submit-create-channel">Create Channel</button>
          </div>
        </form>
      </div>
    </div>
  </div>

  <!-- Server Settings Modal (hidden by default) -->
  <div id="server-settings-modal-overlay" class="profile-modal-overlay" style="display:none;z-index:3000;">
    <div class="profile-modal-container" style="max-width:1600px;">
      <aside class="profile-modal-sidebar modal-slide-in-left">
        <div class="nav-section">SERVER SETTINGS</div>
        <nav class="profile-settings-nav">
          <button class="nav-link active" data-section="server-profile">Server Profile</button>
          <button class="nav-link" data-section="emoji">Emoji</button>
          <button class="nav-link" data-section="members">Members</button>
          <button class="nav-link" data-section="roles">Roles</button>
          <button class="nav-link" data-section="invites">Invites</button>
        </nav>
      </aside>
      <section class="profile-modal-content">
        <header class="profile-modal-header modal-fade-in">
          <h2 id="server-settings-title">Server Profile</h2>
          <button class="profile-modal-close" id="close-server-settings-modal" title="Close">&times;</button>
        </header>
        <div id="server-settings-section-server-profile" class="modal-stagger">
          <form class="profile-form">
            <label>Server Name
              <div id="server-settings-name-row" style="display:flex;align-items:center;gap:0.7rem;">
                <span id="server-settings-name-text" style="font-size:1.13rem;font-weight:700;"></span>
                <button type="button" id="server-settings-edit-name-btn" class="profile-btn secondary" title="Edit Server Name" style="padding:0.3em 0.8em;"><i class="fa-solid fa-pen"></i></button>
                <input type="text" id="server-settings-name-input" class="profile-input" style="display:none;max-width:220px;" maxlength="32" />
                <button type="button" id="server-settings-save-name-btn" class="profile-btn" style="display:none;padding:0.3em 1em;">Save</button>
                <button type="button" id="server-settings-cancel-name-btn" class="profile-btn secondary" style="display:none;padding:0.3em 1em;">Cancel</button>
              </div>
            </label>
            <label>Icon
              <input type="file" id="server-settings-icon" accept="image/*" style="display:none;" />
              <button type="button" class="profile-btn" id="server-settings-change-icon">Change Server Icon</button>
              <img id="server-settings-icon-preview" src="" alt="Server Icon" style="width:64px;height:64px;border-radius:50%;margin-top:0.7rem;display:none;" />
            </label>
            <label>Banner</label>
            <div id="server-settings-banner-colors" style="display:flex;gap:1rem;flex-wrap:wrap;">
              <button type="button" class="profile-btn" style="background:#23272a;"></button>
              <button type="button" class="profile-btn" style="background:#ff73fa;"></button>
              <button type="button" class="profile-btn" style="background:#f04747;"></button>
              <button type="button" class="profile-btn" style="background:#faa61a;"></button>
              <button type="button" class="profile-btn" style="background:#43b581;"></button>
              <button type="button" class="profile-btn" style="background:#5865f2;"></button>
              <button type="button" class="profile-btn" style="background:#00b0f4;"></button>
              <button type="button" class="profile-btn" style="background:#3ba55d;"></button>
              <button type="button" class="profile-btn" style="background:#ffd600;"></button>
            </div>
          </form>
          <div class="profile-preview-section">
            <div class="profile-preview-card" style="max-width:420px;">
              <div class="profile-banner" id="server-settings-banner-preview"></div>
              <div class="profile-avatar-stack">
                <img class="profile-avatar-img" id="server-settings-icon-preview-card" src="" alt="Server Icon">
              </div>
              <div class="profile-info">
                <div class="profile-displayname" id="server-settings-name-preview">Server Name</div>
                <div class="server-profile-id-row" style="margin:0.5rem 0 0.7rem 0;display:flex;align-items:center;justify-content:center;gap:0.6rem;">
                  <span class="server-profile-id" id="server-settings-id-preview" style="font-family:'Roboto Mono',monospace;font-weight:700;color:var(--white);background:rgba(37,99,235,0.08);border-radius:0.4em;padding:0.1em 0.5em;font-size:1.05em;"></span>
                  <button class="profile-copy-id-btn" id="server-settings-copy-id-btn" title="Copy Server ID"><i class="fa-regular fa-copy"></i></button>
                  <span class="profile-copy-feedback" id="server-settings-copy-id-feedback" style="display:none;">Copied!</span>
                </div>
                <div class="profile-username" id="server-settings-meta-preview">1 Online • 1 Member<br>Est. Jun 2025</div>
              </div>
            </div>
          </div>
        </div>
        <div id="server-settings-section-invites" class="modal-stagger" style="display:none;">
          <h3>Pending Join Requests</h3>
          <div id="server-invites-list"></div>
        </div>
        <div id="server-settings-section-members" class="modal-stagger" style="display:none;">
          <h3>Server Members</h3>
      </section>
    </div>
  </div>

  <!-- Server Icon Upload Input (hidden) -->
  <input type="file" id="server-icon-upload-input" accept="image/*" style="display:none;" />

  <!-- Server Icon Crop Modal (hidden by default) -->
  <div id="server-icon-crop-modal" class="avatar-crop-modal" style="display:none;">
    <div class="avatar-crop-modal-content">
      <div id="server-icon-crop-area"></div>
      <div class="avatar-crop-actions">
        <button id="server-icon-crop-confirm" class="profile-btn">Crop & Upload</button>
        <button id="server-icon-crop-cancel" class="profile-btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Server Icon Upload Loading Spinner (hidden by default) -->
  <div id="server-icon-upload-loading" class="avatar-upload-loading" style="display:none;">
    <div class="spinner"></div>
    <span>Uploading...</span>
  </div>

  <!-- Server Banner Upload Input (hidden) -->
  <input type="file" id="server-banner-upload-input" accept="image/*" style="display:none;" />

  <!-- Server Banner Crop Modal (hidden by default) -->
  <div id="server-banner-crop-modal" class="avatar-crop-modal" style="display:none;">
    <div class="avatar-crop-modal-content">
      <div id="server-banner-crop-area" style="border-radius:0.8rem;width:360px;height:90px;"></div>
      <div class="avatar-crop-actions">
        <button id="server-banner-crop-confirm" class="profile-btn">Crop & Upload</button>
        <button id="server-banner-crop-cancel" class="profile-btn secondary">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Server Banner Upload Loading Spinner (hidden by default) -->
  <div id="server-banner-upload-loading" class="avatar-upload-loading" style="display:none;">
    <div class="spinner"></div>
    <span>Uploading...</span>
  </div>

  <footer class="site-footer footer-animate" id="site-footer">
    <div class="footer-content">
      <div class="footer-brand">
        <img src="assets/logo.png" alt="Spice Logo" height="38">
        <span class="footer-title">Spice</span>
      </div>
      <nav class="footer-nav">
        <a href="#" class="footer-link">Home</a>
        <a href="#" class="footer-link">Devs</a>
        <a href="#" class="footer-link">More</a>
      </nav>
      <div class="footer-social">
        <a href="#" class="footer-social-link" aria-label="Twitter"><i class="fa-brands fa-twitter"></i></a>
        <a href="#" class="footer-social-link" aria-label="GitHub"><i class="fa-brands fa-github"></i></a>
        <a href="#" class="footer-social-link" aria-label="Discord"><i class="fa-brands fa-discord"></i></a>
      </div>
    </div>
    <div class="footer-bottom">
      <span>&copy; 2024 Spice. All rights reserved.</span>
      <span class="footer-made">Made with <span style="color:#f87171;">&#10084;&#65039;</span> for chat lovers.</span>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js"></script>
  <script src="app.js" type="module"></script>
  <script src="servers_handler.js"></script>
</body>
</html> 